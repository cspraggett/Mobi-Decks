<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>Home Page</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">


    <link rel="stylesheet" href="/vendor/normalize-4.1.1.css" type="text/css" />
    <link rel="stylesheet" href="/vendor/border-box.css" type="text/css" />
    <link rel="stylesheet" href="/styles/layout.css" type="text/css" />
    <link rel="stylesheet" href="/styles/game.css" type="text/css" />


    <script type="text/javascript" src="/vendor/jquery-3.0.0.js"></script>
    <script type="text/javascript" src="/scripts/app.js"></script>

    <!-- Scripts for Bootstrap -->
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

    <!-- Font -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat&display=swap" rel="stylesheet">

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font: 13px Helvetica, Arial; }
        form { background: #000; padding: 3px; position: fixed; bottom: 0; width: 100%; }
        form input { border: 0; padding: 10px; width: 90%; margin-right: .5%; }
        form button { width: 9%; background: rgb(130, 224, 255); border: none; padding: 10px; }
        #messages { list-style-type: none; margin: 0; padding: 0; }
        #messages li { padding: 5px 10px; }
        #messages li:nth-child(odd) { background: #eee; }
      </style>

      <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.4.5/socket.io.min.js"></script>
      <script src="https://code.jquery.com/jquery-1.11.1.js"></script>

      <script>
        const cardImage = {
          heart: [
            '<img src="/images/cards/AH.png">',
            '<img src="/images/cards/2H.png">',
            '<img src="/images/cards/3H.png">',
            '<img src="/images/cards/4H.png">',
            '<img src="/images/cards/5H.png">',
            '<img src="/images/cards/6H.png">',
            '<img src="/images/cards/7H.png">',
            '<img src="/images/cards/8H.png">',
            '<img src="/images/cards/9H.png">',
            '<img src="/images/cards/10H.png">',
            '<img src="/images/cards/JH.png">',
            '<img src="/images/cards/QH.png">',
            '<img src="/images/cards/KH.png">'
          ],
          spade: [
            '<img src="/images/cards/AS.png">',
            '<img src="/images/cards/2S.png">',
            '<img src="/images/cards/3S.png">',
            '<img src="/images/cards/4S.png">',
            '<img src="/images/cards/5S.png">',
            '<img src="/images/cards/6S.png">',
            '<img src="/images/cards/7S.png">',
            '<img src="/images/cards/8S.png">',
            '<img src="/images/cards/9S.png">',
            '<img src="/images/cards/10S.png">',
            '<img src="/images/cards/JS.png">',
            '<img src="/images/cards/QS.png">',
            '<img src="/images/cards/KS.png">'
          ]
        }

        $(function () {
          const socket = io('http://localhost:8080/game');
          $('form').submit(function(e){
            e.preventDefault(); // prevents page reloading
            socket.emit('chat message', `{ "id": "${socket.id}", "msg": "${$('#m').val()}" }`);
            $('#m').val('');
            return false;
          });

          // when recieveing chat message from server display message
          socket.on('chat message', function(msg){
            const data = JSON.parse(msg);
            console.log(data.msg);
            // $('#messages').append($('<li>').text(data.msg));
          });

          // socket.on('game start', function(msg){
          //   const data = JSON.parse(msg);

          // });

          socket.on('system', function(msg){
            const data = JSON.parse(msg);
            console.log('system: ' + data.msg);

            if (data.type === 'start') {
              $('.p2-won').empty();
              $('.p2-hand').empty();
              // $('.bid-table').empty();
              $('.bids').empty();
              $('.dealer-bid').empty();
              $('.p1-hand').empty();
              $('.p1-won').empty();
            }

            // console.log(data);
            // if (data.id === 0) $('#messages').append($('<li>').text(
            //   `${data.char}: ` + data.hand, data.heldCard, data.currentBid
            // ));
            // if (data.id > 0) $('#messages').append($('<li>').text(
            //   `${data.char}: ` + data.hand, data.wonBids, data.score, data.socketID, data.currentBid
            // ));

          });

          const dealerPlay = function(arr) {
            arr = arr.slice(1);
            $('.dealer-bid').append($('<img src="/images/cards/2C.png">'));
          }

          const spawnCardsWithDelay = function(info, loc, eff) {
            if (info.hand.length > 0) {
              setTimeout(() => {
                let num = info.hand.shift().toString();
                let color = "heart";
                if (info.id === 1) color = "spade";
                console.log(color, num);
                $(loc).append($(`<div class="cards ${eff}">`).append($(cardImage[color][num])));
                spawnCardsWithDelay(info, loc, eff);
              }, 30);
            }
          }

          socket.on('gameInfo', function(msg){
            const data = JSON.parse(msg);
            console.log(data);
            console.log(data.phase);

            //initialization
            if (data.phase === 0) {
              spawnCardsWithDelay(data.opponent, ".p2-hand", "top");
              spawnCardsWithDelay(data.player, ".p1-hand", "bot");
              data.phase = 1;
            }
            // at the start of each phase
            if (data.phase < 14) {
            dealerPlay(data.dealer.hand);
            }
          });
        });
      </script>

  </head>

  <body>
    <div class='board'>

      <div class='p2-won row'>
        <div class='centering'>
        </div>
        <div class='p2-cards-won'>
          <img src='/images/cards/2C.png' />
        </div>
        <div class='p2-cards-won'>
          <img src='/images/cards/2C.png' />
        </div>
        <div class='p2-cards-won'>
          <img src='/images/cards/2C.png' />
        </div>
      </div>

      <div class='p2-hand row id=p2_hand'>
        <div class='centering'>
        </div>
      </div>

      <div class='bid-table row'>

        <div class='col user-scores'>
          <div class='row'>
            <img src='/images/avatars/avatar.png' />
            <p>10</p>
          </div>
          <div class='row'>
            <img src='/images/avatars/avatar.png' />
            <p>10</p>
          </div>
        </div>

        <div class='col bids'>
          <div class='row bid-card'>
            <img src='/images/cards/2C.png' />
          </div>
          <div class='row bid-card'>
            <img src='/images/cards/2C.png' />
          </div>
        </div>

        <div class='col dealer-side'>
          <div class='dealer-bid'>
            <img src='/images/cards/2C.png' />
          </div>
        </div>

      </div>

      <div class='p1-hand row id=p2_hand'>
        <div class='centering'>
        </div>
      </div>

      <div class='p1-won row'>
        <div class='centering'>
        </div>
        <div class='p1-cards-won'>
          <img src='/images/cards/2C.png' />
        </div>
        <div class='p1-cards-won'>
          <img src='/images/cards/2C.png' />
        </div>
      </div>

  </div>

    <ul id="messages"></ul>
    <form action="">
      <input id="m" autocomplete="off" /><button>Send</button>
    </form>
  </body>

</html>
